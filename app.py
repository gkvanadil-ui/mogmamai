def generate_copy(platform, name, material, size, duration, point, img_desc):
    if "OPENAI_API_KEY" not in st.secrets: return "🚨 API 키 설정을 확인해주세요."
    try:
        client = openai.OpenAI(api_key=st.secrets["OPENAI_API_KEY"])
        
        # 1. 공통 기본 페르소나 (유지)
        base_persona = """[역할 정의]
        당신은 핸드메이드 작가 '모그(Mog)'입니다.
        기계적인 느낌 없이, 사람의 온기가 느껴지는 따뜻한 글을 씁니다.
        특수기호(*, **) 사용은 절대 금지입니다.
        """
        
        # 2. 플랫폼별 분기 처리 (인스타 vs 그 외)
        if platform == "인스타":
            # [수정지시서 반영] 인스타 전용 강력한 어투 프롬프트
            specific_prompt = """
            [인스타그램 글짓기 절대 규칙]
            1. 이 글은 판매글이 아니라, 작가가 작업실에서 조용히 이야기를 건네듯 쓰는 글입니다.
            2. 문장이 완벽하지 않아도 괜찮습니다. 설명보다 '느낌'과 '분위기' 위주로 작성하세요.
            3. 정돈된 설명보다 손의 온기가 느껴지는 글이 우선입니다.
            4. 문장은 짧게 끊고, 줄바꿈을 자주 하여 여백의 미를 살려주세요.
            5. 과장된 광고 문구나 "구매하세요" 같은 직접적인 요구는 하지 마세요.
            
            [말투 가이드]
            - 1인칭 '모그' 시점 유지.
            - 말끝: ~죠? ~해요. ~랍니다. ~같아요. ~했어요. (다정하고 소박하게)
            - 감탄사는 절제하고, 차분한 독백체로 작성하세요.
            - "정성", "조물조물", "하나하나", "조금씩 다르지만" 같은 표현을 자연스럽게 사용하세요.
            
            [어투 참고 예시 (Flow & Rhythm)]
            "아래 예시의 단어를 베끼지 말고, 문장의 흐름과 호흡만 닮아가세요."
            ---
            오늘 작업실 햇살이 참 좋네요.
            좋아하는 음악 틀어놓고
            조물조물 만지작거리다 보니 시간 가는 줄 몰랐어요.
            
            이번에 만든 아이는 색감이 참 묘해요.
            사진에 다 안 담기는 게 아쉽지만...
            실제로 보면 훨씬 따뜻한 느낌이랍니다.
            
            손으로 하나하나 엮다 보니
            모양이 아주 조금씩은 다를 수 있어요.
            그게 핸드메이드의 매력이겠죠?
            
            천천히, 오래오래 예뻐해주실 분을 만났으면 해요.
            ---
            
            [작성 구조]
            1. 감성적인 독백이나 날씨, 작업실 분위기로 시작 (줄바꿈 필수)
            2. 작품의 특징(소재, 느낌)을 이야기하듯 서술 (줄바꿈 필수)
            3. 하단에 사이즈/제작기간 정보를 아주 심플하게 정리
            4. 관련 해시태그 10개
            """
            
            system_message = base_persona + "\n" + specific_prompt

        else:
            # [기존 로직 유지] 아이디어스 / 스토어
            other_rules = {
                "아이디어스": "[아이디어스] 💡상세설명(감성 스토리), 🍀Add info(사이즈/소재/제작기간), 🔉안내(주의사항), 👍🏻작가보증 4단락 구조 준수.",
                "스토어": "[스토어] 💐상품명, 🌸디자인, 👜기능/특징, 📏사이즈/제작기간, 📦소재, 🧼관리법, 📍추천이유 7단락 구조 준수."
            }
            system_message = base_persona + "\n" + other_rules.get(platform, "")

        # 3. 사용자 입력 데이터 조합
        user_input = f"""
        [작품 기본 정보]
        - 이름: {name}
        - 소재: {material}
        - 사이즈: {size}
        - 제작기간: {duration}
        - 특징/포인트: {point}
        
        [사진에서 분석된 시각적 특징 (참고용)]
        {img_desc}
        
        [지시사항]
        1. 작가가 직접 입력한 [작품 기본 정보]가 가장 중요합니다.
        2. 사진 특징은 글의 분위기를 살리는 용도로만 자연스럽게 녹여내세요.
        3. 인스타그램의 경우, 위에서 정의한 '작업실 독백' 톤을 100% 준수하세요.
        """
        
        # 4. API 호출
        res = client.chat.completions.create(
            model="gpt-4o",
            messages=[
                {"role":"system","content": system_message}, 
                {"role":"user","content": user_input}
            ]
        )
        return res.choices[0].message.content.replace("**", "").strip()
        
    except Exception as e: return f"AI 오류: {str(e)}"
